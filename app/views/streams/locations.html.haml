<div class='sidebar'>
  <p class='make_bold'>Manhattan Food Truck Finder</p>
    <% if @locations == [] %>
      No recent tweets, check back during lunch hours!
    <% else %>
    Recent tweets by:

      <ul><%- @locations.sort_by(&:time).reverse.each do |l| %>
        <li id='<%= l.id %>' class='l.id'><a href="javascript:void(<%= l.id %>)" class='trucks' data-toggle="tooltip" ><%= l.truck.name %>, <%= time_ago_in_words(time_formater(l.time)) %></a></li>
      <% end %>
      </ul>
    <% end %>
</div>
<div id="map-canvas" class='the_map'>
  <script type="text/javascript">
    $(document).ready(function(){
      var source = new LocationSource('/locations_stream');
        source.addEventListener('coordinates', function(e) {
          console.log(e.data);
        });
      });
    })
    
    // function initialize() {
    //   var mapOptions = {
    //     center: new google.maps.LatLng(40.768483, -73.981248),
    //     zoom: 12,
    //     mapTypeId: google.maps.MapTypeId.ROADMAP
    //   };
    //   var map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);
    //   <%- @locations.each do |location| %>
    //     var markerPosition = new google.maps.LatLng(<%= location.latitude %>, <%= location.longitude %>);
    //     var image = 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';
    //     var marker<%= location.id %> = new google.maps.Marker({
    //               position: markerPosition,
    //               map: map,
    //               icon: image
    //             });
    //     var contentString<%= location.id %> = '<div><p>Food Truck: <%= location.truck.name %></br>' + '<br />Tweet: <%= location.twitter_text.gsub(/\n/,'').gsub('&amp', '&') %></p></div>';
    //     marker<%= location.id %>.infowindow = new google.maps.InfoWindow({
    //       content: contentString<%= location.id %>,
    //       maxWidth: 300
    //     });
    //     google.maps.event.addListener(marker<%= location.id %>, 'click', function() {
    //       marker<%= location.id %>.infowindow.open(map, marker<%= location.id %>);
    //     });
    //     google.maps.event.addListener(map, 'click', function() {
    //       marker<%= location.id %>.infowindow.close(map, marker<%= location.id %>);
    //       map.setZoom(12);
    //     });
    //     $('#<%= location.id %>').mouseover(function(){
    //       google.maps.event.trigger(marker<%= location.id %>, 'mouseover');
    //       marker<%= location.id %>.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
    //       marker<%= location.id %>.infowindow.open(map, marker<%= location.id %>);
    //     });
    //     $('#<%= location.id %>').mouseout(function(){
    //       google.maps.event.trigger(marker<%= location.id %>, 'mouseout');
    //       marker<%= location.id %>.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
    //       marker<%= location.id %>.infowindow.close(map, marker<%= location.id %>);
    //     });
    //     $('#<%= location.id %>').click(function(){
    //       google.maps.event.trigger(marker<%= location.id %>, 'click');
    //       map.setZoom(16);
    //       map.panTo(marker<%= location.id %>.position);
    //     });
    // <% end %>
    // }
    // google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</div>